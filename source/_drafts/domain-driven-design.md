---
title: 我所理解的领域驱动设计
date: 2023-09-12 14:49:07
keywords: 领域驱动设计，DDD
tags:
- DDD
description: 对于领域驱动设计的浅薄理解，以及基础知识
---


- 领域

  领域用来限定业务边界和范围。领域可以进一步划分为子领域。

- 限界上下文

  在限定的上下文环境内，用来封装领域对象。定义限界上下文时通常会考虑领域业务职责单一这个因素。同一事物在不同的业务领域中会有不同的含义。
  > 商品在销售阶段时商品，在运输阶段是货物。


- 实体

  拥有唯一标识符。实体类通常采用充血模型，
与实体相关的所有业务逻辑都在实体类方法中实现，跨多个实体的领
域逻辑则在领域服务中实现。


- 值对象

  值对象是通过对象属性值来识别的对象，是一个没有标识符的对象。它可以和其他值对象进行相等性比较，不过不是基于ID，而是基于值对象的属性。值对象可以是来源于其他聚合，是冗余数据。
  > 例如：人员实体原本包括：姓名、年龄、性别以及人员所在省、市、区、县和街道等属性。可以将省、市、区等这些属性提取出来构成一个地址的属性集合，即为地址值对象。

- 聚合 P72 P82

  聚合内部有自己的业务规则，在实现聚合内的业务逻辑时，可以保证数据的一致性。
  > 例如：订单聚合每次修改商品数据时，它们都必须符合：“订单总金额等于所有商品明细金额之和“。


  在聚合中有一个聚合根和上下文边界，它主要是根据业务的单一职责和高内聚设计原则。一个领域层可以有多个聚合，每个聚合内有一个聚合根，多个实体、值对象和领域服务等领域对象。

  聚合在领域模型里时一个逻辑边界，它本身没有业务逻辑实现相关的代码。聚合个的业务逻辑由聚合内的聚合根、实体、值对象和领域服务等来实现。聚合内的实体以充血模型实现自身的业务逻辑。跨多个实体的领域逻辑通过领域服务来实现。跨多个聚合的业务逻辑的组合和编排，是通过应用服务来实现的。
  
  聚合的设计原则：

  - 在一致性边界内建模真正的不变条件
  - 设计小聚合
  - 通过唯一标识引用其他聚合
  - 在边界之外使用最终一致性
  - 通过应用层实现跨聚合的服务调用

  聚合的设计模式：

  - 仓储模式
  
  仓储模式主要完成领域对象持久化。领域层应该更多关注领域逻辑实现，为了解耦领域逻辑和数据处理逻辑，在领域层和基础层中增加了一层仓储层。
  
  仓储模式包含仓储接口和仓储实现，仓储接口面向领域层提供基础层数据处理相关的访问接口，仓储实现完成仓储接口对应的数据持久化相关的逻辑处理。

  > 这样领域层就可以更好地聚焦于领域逻辑，而不必关心基础层如何实现持久化。当需要更换数据库等基础资源时，只需要调整仓储实现代码，做好仓储实现数据持久化处理逻辑与新数据库的适配即可。
  
  - 工厂模式

  工厂模式主要用于聚合领域对象的创建和数据初始化。对于实体和值对象比较多和依赖关系复杂的聚合，在 DO 对象创建时，需要确保聚合根和它依赖的对象实例同时被创建。如果由聚合根来实现，聚合根构造函数的逻辑会非常复杂，也无法聚焦于自身的领域逻辑，因而将它们放到工厂中实现。

  工厂在进行DO对象初始化和持久化操作时，通常会与仓储一起配合完成。数据初始化时，先从仓储获取PO对象，然后通过工厂完成DO对象的初始化。DO对象持久化时，通过工厂完成DO到PO的数据转换，然后通过仓储完成持久化。

- 领域服务


- 应用服务

